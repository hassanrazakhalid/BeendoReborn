<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">
<h:head>

<f:metadata>
		<f:viewAction actionListener="#{transactionController.onLoad()}" />
	</f:metadata>

</h:head>

<h:body>

	<h:body>
		<ui:composition template="/Views/Template/MainTemplate.xhtml">
			<ui:define name="pageTitle">
            Welcome [Dashboard.xhtml]
        </ui:define>

			<ui:define name="mainContent">
				<h2>Transaction Details</h2>
				
				<h:form rendered="#{transactionController.canCreate()}">
					<p:commandButton value="Create" update=":myForm"
						action="#{transactionController.clearData()}"
								oncomplete="PF('Dlg1').show();"
								style="float: right; margin-top: 25px;"
								 />								
					<br/>
					
									<h:panelGrid columns="3">
				<h:outputLabel for="payerMenu" value="Filter:" />
				<p:selectCheckboxMenu id="payerMenu" label="Select payer" 
				value="#{transactionController.payerFilter}"
				 converter="javax.faces.Integer"
				
				 onHide="PF('transactionsTable').filter()"
				>
				
				 <f:ajax event="change" />
				<f:selectItems value="#{transactionController.payerList}" var="payer"
				itemLabel="#{payer.name}" itemValue="#{payer.id}"/>
				
				
				
				</p:selectCheckboxMenu>
				</h:panelGrid>
					
				</h:form>
				
				<!-- filterTransactions
				paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
				 
				 -->
				 <h:form id="mainForm"> 
    
				    <p:dataTable
				     filteredValue="#{transactionController.realTimefilterList}"
				      value="#{transactionController.lazyModel}" var="transaction"
				      lazy="true" paginator="true" 
				      rows="10"
				      rowsPerPageTemplate="10,20,35"
				      widgetVar="transactionsTable"
				       >
					
						<p:column headerText="Payer Name" filterBy="#{transaction.payerList}" filterFunction="#{transaction.filterByPayer}">
							<!-- #{transaction.payer.name} #{transaction.payer.planName} -->
							
							<table>
								<ui:repeat value="#{transaction.payerList.toArray()}" var="t">
								
									<tr>
										<td style="border: 0px;"><h:outputText value="#{t.name} #{t.planName}" />
										</td>

									</tr>
								</ui:repeat>
							</table>
							
						</p:column>
						
						<p:column headerText="Practice Name" filterMatchMode="contains" filterBy="#{transaction.practice.name}">
							#{transaction.practice.name}
						</p:column>
						
						<p:column headerText="Provider Name" filterMatchMode="contains" filterBy="#{transaction.provider.getFullName()}">
							#{transaction.provider.getFullName()}
						</p:column>

						<p:column headerText="Date">
							#{transaction.transactionDate}
						</p:column>
						
						<p:column headerText="Type">
							#{transaction.transactionType}
						</p:column>
						
						<p:column headerText="Comments">
							#{transaction.comments}
						</p:column>
						
						<p:column headerText="Status">
							#{transaction.parStatus}
						</p:column>						
						
						<p:column headerText="Edit" width="80"
							rendered="#{transactionController.canEdit()}">
							<p:commandButton icon="ui-icon-pencil" update=":myForm"
								oncomplete="PF('Dlg1').show();"
								action="#{transactionController.updateClicked(transaction)}" />

							<p:commandButton icon="ui-icon-close" update=":mainForm"
								resetValues="true"
								rendered="#{transactionController.shouldShowDelete()}"
								action="#{transactionController.removeClicked(transaction)}"	
								>

								<p:confirm header="Confirmation" message="Are you sure?"
									icon="ui-icon-alert" />
							</p:commandButton>

							<p:confirmDialog global="true" showEffect="fade"
								hideEffect="fade">
								<p:commandButton value="Yes" type="button"
									styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
								<p:commandButton value="No" type="button"
									styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
							</p:confirmDialog>

						</p:column>
		
					</p:dataTable>
				    
				 </h:form>
				
				
				
				<!-- ADD / EDIT DIALOG -->
				
				<p:dialog id="transDialog" header="Transaction"  modal="true" position="top" widgetVar="Dlg1" minHeight="40">
				    
				  <h:form id="myForm">
				  
				  	<p:messages id="msgs" />
				  	
				  	<h:panelGrid columns="4" cellpadding="8"> 
				  	
					   <p:selectOneRadio id="currentRadio" value="#{transactionController.currentRadio}">
				            <f:selectItem itemLabel="Practice" itemValue="rbPractice" />
				            <f:selectItem itemLabel="Provider" itemValue="rbProvider" />
				            
				            <p:ajax event="change" listener="#{transactionController.onSelectionChange}" update=":myForm" /> 
				            
				        </p:selectOneRadio> 
						
						<!-- <p:outputLabel for="idPractice" value="Select Practices: " />  -->
						
						<p:selectOneMenu id="idPractice" value="#{transactionController.currentPractice}"
							panelStyle="width:180px" effect="fade" rendered="#{transactionController.canPracticeShow}"
							converter="javax.faces.Integer" required="true"
							requiredMessage="Select atleast one practice"
							 style="width:177px">
							
							<!-- <p:ajax event="change" listener="#{transactionController.onPracticeChange}" update="idPayer" />  -->
							
							<f:selectItem itemLabel="Select Practice" />
							
							<f:selectItems value="#{transactionController.practiceList}" var="entity"
								itemLabel="#{entity.name}" itemValue="#{entity.id}"  />

						<!-- 	<p:column>
								<h:outputText value="#{t.name}" />
							</p:column> -->
						</p:selectOneMenu>
						
						<p:selectOneMenu id="idProvider" value="#{transactionController.currentProvider}"
							panelStyle="width:180px" effect="fade" rendered="#{!transactionController.canPracticeShow}"
							converter="javax.faces.Integer" required="true"
							requiredMessage="Select atleast one provider"
							 style="width:177px">
							
							<f:selectItem itemLabel="Select Provider" />
							
							<f:selectItems value="#{transactionController.providerList}" var="entity"
								itemLabel="#{entity.getNameWithNPI()}" itemValue="#{entity.id}"  />
								
								<!--  #{entity.lastName} -->
							<!-- <p:ajax event="change" listener="#{transactionController.onProviderChange}" update="idPayer" />  -->

						<!-- 	<p:column>
								<h:outputText value="#{t.getNameWithNPI()}" />
							</p:column> -->
						</p:selectOneMenu>
				  	
				  	</h:panelGrid>
				  	
				  	<br />
				  
				  	<h:panelGrid columns="4" cellpadding="8">  
				  	
				  		<p:outputLabel for="idPayer" value="Select Payer: " />
				  	    <p:selectCheckboxMenu id="idPayer" value="#{transactionController.selectedPayers}"
				  	    requiredMessage="Select atleast one payer"
				            filter="false" filterMatchMode="startsWith" style="width:177px" required="true"
				            converter="javax.faces.Integer" panelStyle="width:250px">
				            
				            <f:selectItems value="#{transactionController.payerList}" var="payer"
								itemLabel="#{payer.name} #{payer.planName}" itemValue="#{payer.id}"  />

						<!-- 	<p:column>
								<h:outputText value="#{t.name}" />
							</p:column> -->
				            
				        </p:selectCheckboxMenu> 
				  		<!-- <p:selectOneMenu id="idPayer" value="#{transactionController.currentPayer}"
							panelStyle="width:180px" effect="fade"  
							converter="payerConverter" required="true"
							var="t" style="width:177px">
							
							<f:selectItem itemLabel="Select" />
							<f:selectItems value="#{transactionController.payerList}" var="entity"
								itemLabel="#{entity.name} #{entity.planName}" itemValue="#{entity}"  />

							<p:column>
								<h:outputText value="#{t.name} #{t.planName}" />
							</p:column>
						</p:selectOneMenu> -->
						
						
						<p:outputLabel for="idType" value="Transaction Type: " />
						<p:selectOneMenu id="idType" value="#{transactionController.transaction.transactionType}" style="width:177px">
				            <f:selectItem itemLabel="Application Process" itemValue="Application Process" />
				            <f:selectItem itemLabel="Communication with Provider" itemValue="Communication with Provider" />
				            <f:selectItem itemLabel="Communication with Payer" itemValue="Communication with Payer" />
				            <f:selectItem itemLabel="Status Update" itemValue="Status Update" />
				        </p:selectOneMenu>
				  	
				  		<p:outputLabel for="idDate" value="Current Date: " />
				  	 	<p:inputText id="idDate" value="#{transactionController.transaction.transactionDate}" required="true" /> 
			            
			            <h:outputLabel for="vname" value="Select Status:" />
			        	<p:selectOneMenu id="vname" value="#{transactionController.transaction.parStatus}" style="width:175px">
			        		
			        		<f:selectItems value="#{transactionController.statusList}" var="v"
			        		itemLabel="#{v}" itemValue="#{v}"/>
			        		<!-- <f:selectItem itemLabel="New-Provider" itemValue="New-Provider" />
			        		<f:selectItem itemLabel="Non-Par" itemValue="Non-Par" />
				            <f:selectItem itemLabel="PAR" itemValue="PAR" />				            
				            <f:selectItem itemLabel="Application Package Complete" itemValue="Application Package Complete" />
				            <f:selectItem itemLabel="Application Filed" itemValue="Application Filed" />
				            <f:selectItem itemLabel="Application Accepted" itemValue="Application Accepted" />
				            <f:selectItem itemLabel="Application Rejected" itemValue="Application Rejected" />
				            <f:selectItem itemLabel="Effective Date Assigned" itemValue="Effective Date Assigned" />
				            <f:selectItem itemLabel="Letter Received" itemValue="Letter Received" /> -->
				        </p:selectOneMenu> 
			            
			        </h:panelGrid>
			        
			        <h:panelGrid columns="2" cellpadding="16">
			        	<p:outputLabel for="idComments" value="Comments: " />
			        	<p:inputTextarea id="idComments" rows="6" cols="100"
			        	 value="#{transactionController.transaction.comments}"
			        	 placeholder="Comments" />
			            <!-- <p:inputText id="idComments" value="#{transactionController.transaction.comments}" 
			            	placeholder="Comments" style="width:580px" /> --> 
			        </h:panelGrid>   

					<br />
				  
				  	<p:commandButton id="btnSave" value="Save" actionListener="#{transactionController.saveInfo()}"
				    		validateClient="true" update="myForm, msgs, :mainForm" />
				
							<p:blockUI trigger="myForm:btnSave" block="transDialog"
						widgetVar="block">
            LOADING<br />
						<p:graphicImage value="/Images/loading.gif" width="75" height="75" />
					</p:blockUI>
					
				  </h:form>

		

				</p:dialog>

<style>
.ui-dialog{
	top: 10% !important;
	position: absolute !important;
	left: 15% !important;

}

</style>				
				
			<script type="text/javascript">
    function handleDialogSubmit(args, dialogName) {

    	console.log('In handle');
        
        if (!args.validationFailed) {
            PF(dialogName).hide();
        }
    }	
				</script>
			</ui:define>
		</ui:composition>
	</h:body>


</h:body>

</html>
