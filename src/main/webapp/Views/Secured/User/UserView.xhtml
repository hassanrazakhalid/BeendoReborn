<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://java.sun.com/jsf/core">

<h:head></h:head>


<h:body>
	<ui:composition template="/Views/Template/MainTemplate.xhtml">
		<ui:define name="pageTitle">
            Welcome [UserView.xhtml]
        </ui:define>

		<ui:define name="mainContent">

			<h:form rendered="#{sharedData.currentUser.canCreateUser}">

				<p:commandButton actionListener="userController.createUserClicked()"
					process="@this" value="Create User"
					oncomplete="PF('userCreateDialog').show()" />
				<br />
			</h:form>

			<h:form id="userTable">
				<p:dataTable value="${userController.listUsers}" var="user">

					<p:column headerText="Name">
					#{user.name}
					</p:column>
					<p:column headerText="Email">
					#{user.email}
					</p:column>
					<p:column headerText="Password">
					#{user.password}
					</p:column>
					<p:column headerText="Role">
					#{user.role.name}
					</p:column>
					<p:column headerText="Entity">
					#{user.entity.name}
					</p:column>
					<p:column headerText="Practise">
						<table>
							<ui:repeat value="#{user.practises.toArray()}" var="t">

								<tr>
									<td style="border: 0px;"><h:outputText value="#{t.name}" />
									</td>

								</tr>
							</ui:repeat>
						</table>
					</p:column>

					<p:column headerText="Operation">

						<p:commandButton value="edit"
							actionListener="#{userController.editButtonClicked(user)}"
							oncomplete="PF('userCreateDialog').show()" update=":userForm" />

						<!-- <p:commandButton value="remove"
								action="#{userController.remove(user)}"
								update=":userTable" resetValues="true">

								<p:confirm header="Confirmation" message="Are you sure?"
									icon="ui-icon-alert" />
							</p:commandButton> -->

						<p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
							<p:commandButton value="Yes" type="button"
								styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
							<p:commandButton value="No" type="button"
								styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
						</p:confirmDialog>

					</p:column>

				</p:dataTable>
			</h:form>

			<p:dialog id="userDialog" header="Create User" modal="true"
				widgetVar="userCreateDialog">

				<h:form id="userForm">

					<p:panelGrid id="panelGrid" columns="2">
						<p:outputLabel for="tfUsername" value="UserName:" />
						<p:inputText id="tfUsername" value="${userController.user.name}"></p:inputText>

						<p:outputLabel for="tfPassword" value="Password:" />
						<p:inputText id="tfPassword"
							value="${userController.user.password}"></p:inputText>

						<p:outputLabel for="tfEmail" value="Email:" />
						<p:inputText id="tfEmail" value="${userController.user.email}"></p:inputText>

						<p:outputLabel for="listEntity" value="Select Entity:" />


						<p:selectOneMenu id="listEntity"
							value="#{userController.selectedEntity}"
							converter="entityConverter" panelStyle="width:180px"
							effect="fade" var="t" style="width:160px" filter="true"
							filterMatchMode="startsWith">

							<f:selectItems value="#{userController.listEntities}"
								var="entity" itemLabel="#{entity.name}" itemValue="#{entity}" />
							<p:ajax event="change" execute="@this"
								listener="#{userController.entityChanged()}" update=""></p:ajax>

							<p:column>
								<h:outputText value="#{t.name}" />
							</p:column>
						</p:selectOneMenu>

						<p:outputLabel for="listPractise" value="Select Practise:" />
						<p:selectCheckboxMenu id="listPractise"
							value="#{userController.selectedPrac}" label="Select Practices"
							style="width:177px" panelStyle="width:250px"
							converter="practiseConverter">

							<f:selectItems value="#{userController.listPractise}"
								var="practice" itemLabel="#{practice.name}"
								itemValue="#{practice}" />

						</p:selectCheckboxMenu>

						<p:outputLabel for="listRoles" value="Select Role:" />
						<p:selectOneMenu id="listRoles"
							value="#{userController.selectedRole}" panelStyle="width:180px"
							converter="roleConverter" effect="fade" var="t"
							style="width:160px">

							<f:selectItems value="#{userController.listRoles}" var="role"
								itemLabel="#{role.name}" itemValue="#{role}" />

							<p:column>
								<h:outputText value="#{t.name}" />
							</p:column>
						</p:selectOneMenu>

						<h:outputText value="Can Create User: " />
						<p:selectBooleanCheckbox
							value="#{userController.user.canCreateUser}" />
						<h:outputText value="Send Email: " />
						<p:selectBooleanCheckbox value="#{userController.sendEmail}" />

					</p:panelGrid>

					<br />
					<p:commandButton value="Save"
						action="#{userController.createButtonClicked()}"
						update=":userTable,userForm"
						oncomplete="PF('userCreateDialog').hide()" />
				</h:form>
			</p:dialog>

		</ui:define>
	</ui:composition>


</h:body>

</html>